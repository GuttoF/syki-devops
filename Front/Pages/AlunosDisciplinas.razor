@page "/alunos/disciplinas"
@attribute [Authorize(Roles = "Aluno")]

<PageTitle>Disciplinas</PageTitle>

<MudContainer>
    <MudCard Class="mt-8 mb-4 mx-6 px-2">
        <MudCardContent>
            <MudStack Row="true" AlignItems="AlignItems.Center">
                <MudText Typo="Typo.h5" Style="font-weight: bold" >Disciplinas</MudText>
                <MudSpacer />
            </MudStack>
        </MudCardContent>
    </MudCard>

    <MudContainer Class="mb-8">
        <MudExpansionPanels MultiExpansion="true">
            @foreach(var periodo in _disciplinas.ConvertAll(d => d.Periodo).Distinct().Order())
            {
                <MudExpansionPanel IsInitiallyExpanded="@(periodo==1)">
                    <TitleContent>
                        <div class="d-flex">
                            <MudIcon Icon="@Icons.Material.Filled.ArrowRight" class="mr-3"></MudIcon>
                            <MudText><strong>@($"{periodo}º Período")</strong></MudText>
                        </div>
                    </TitleContent>
                    <ChildContent>
                            <MudDataGrid
                                ColumnResizeMode="ResizeMode.None"
                                SortMode="SortMode.None" ShowColumnOptions="false" Class="px-4 pb-2"
                                Elevation="0" Dense="true" Items="@_disciplinas.Where(x => x.Periodo == periodo)" Hover="true">
                                <Columns>
                                    <PropertyColumn Property="x => x.Nome" Title="Nome" />
                                    <PropertyColumn Property="x => x.Creditos" Title="Créditos" />
                                    <PropertyColumn Property="x => x.CargaHoraria" Title="Carga Horária" />
                                </Columns>
                            </MudDataGrid>
                    </ChildContent>
                </MudExpansionPanel>
            }
        </MudExpansionPanels>
    </MudContainer>
</MudContainer>

@using Syki.Dtos
@inject HttpClient Http
@inject IDialogService DialogService

@code {
    private List<DisciplinaOut> _disciplinas = new();

    protected override async Task OnInitializedAsync()
    {
        _disciplinas = await Http.GetFromJsonAsync<List<DisciplinaOut>>("alunos/disciplinas") ?? new();
    }
}
