@namespace Syki.Front.Pages.Student

@page "/student/frequency"
@attribute [Authorize(Roles = "Student")]

<SykiPageTitle Title="Frequência" />

<MudContainer Class="my-4 px-4">
    <SykiPageHeader Icon="@Icons.Material.Filled.Class" Title="Frequência" />
    <MudContainer Class="px-0 my-4">
        <MudContainer Class="px-0 mb-8">
            <MudTable
                T="GetStudentFrequenciesOut"
                Items="@_frequencies"
                Class="pa-4"
                Breakpoint="Breakpoint.Sm"
                Dense="true"
                Hover="true"
                Loading="@_loading"
                RowsPerPage="100">
                <HeaderContent>
                    <MudTh>Escopo</MudTh>
                    <MudTh>Período</MudTh>
                    <MudTh>Aulas</MudTh>
                    <MudTh>Frequência</MudTh>
                </HeaderContent>
                <RowTemplate>
                    <MudTd DataLabel="Escopo">@context.Name</MudTd>
                    <MudTd DataLabel="Período">@context.Period</MudTd>
                    <MudTd DataLabel="Aulas">@context.GetFormated()</MudTd>
                    <MudTd DataLabel="Frequência">
                        <MudProgressLinear Color="Color.Primary" Rounded="true" Size="Size.Large" Value="@decimal.ToDouble(context.GetPercentage())" Style="height: 24px">
                            <MudText Typo="Typo.body1">
                                <b>@context.GetPercentage().Format()%</b>
                            </MudText>
                        </MudProgressLinear>
                    </MudTd>
                </RowTemplate>
            </MudTable>
        </MudContainer>
    </MudContainer>
</MudContainer>

@inject GetStudentFrequenciesClient Client

@code
{
    private bool _loading;
    private List<GetStudentFrequenciesOut> _frequencies = [];

    protected override async Task OnInitializedAsync()
    {
        _loading = true;
        var response = await Client.Get();
        if (response.IsSuccess()) _frequencies = response.GetSuccess();
        _loading = false;
    }
}
