@page "/cursos"

<PageTitle>Cursos</PageTitle>

<MudContainer Class="mt-8 px-8" MaxWidth="MaxWidth.False">
    @if(CursosOut == null)
    {
        <MudProgressLinear Color="Color.Primary" Indeterminate="true" Class="my-7" />
    }
    else
    {
        <MudGrid>
            <MudItem xs="12">
                <MudGrid Justify="Justify.FlexStart">
                    @foreach (var c in CursosOut)
                    {
                        <MudItem xs="12" sm="6" md="4" lg="3" xl="2">
                            <MudPaper Height="150px" Class="d-flex flex-column align-center justify-center mud-width-full py-8">
                                <MudText Typo="Typo.h6" Align="Align.Center">@c.Nome</MudText>
                                <MudStack Row="true">
                                    <MudChip Label="true" Variant="Variant.Text" Color="Color.Primary" Size="Size.Medium">@c.Tipo.GetDescription()</MudChip>
                                </MudStack>
                            </MudPaper>
                        </MudItem>
                    }
                    <MudItem xs="12" sm="6" md="4" lg="3" xl="2">
                        <MudButton
                            StartIcon="@Icons.Material.Outlined.Add"
                            IconSize="Size.Large"
                            Variant="Variant.Outlined"
                            FullWidth="true"
                            Class="border-dashed border-2 mud-border-secundary"
                            Style="height: 150px;"
                            Color="Color.Primary"
                            @onclick="OpenDialog"
                        >
                            Novo Curso
                        </MudButton>
                    </MudItem>
                </MudGrid>
            </MudItem>
        </MudGrid>
    }
</MudContainer>

@using Syki.Dtos
@using System.Net.Http.Json
@inject HttpClient httpClient
@inject IDialogService DialogService

@code {
    private List<CursoOut>? CursosOut;

    protected override async Task OnInitializedAsync()
    {
        CursosOut = await httpClient.GetFromJsonAsync<List<CursoOut>>("/cursos") ?? new();
    }

    private async Task OpenDialog()
    {
        var options = new DialogOptions {
            Position = DialogPosition.TopCenter,
            MaxWidth = MaxWidth.Small,
            FullWidth = true
        };
        var dialog = DialogService.Show<NewCursoDialog>("Novo Curso", options);

        var result = await dialog.Result;

        if (result.Cancelled) return;
        
        await OnInitializedAsync();
    }
}
