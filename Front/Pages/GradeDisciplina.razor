<MudForm @ref="form">
    <MudStack Row="true">
        <MudItem xs="6">
            <MudSelect
                Value="@_disciplina"
                ValueChanged="(DisciplinaOut newValue) => HandleValueChanged(newValue)"
                Label="Disciplina"
                Required="true" RequiredError="Informe a disciplina!" AdornmentColor="Color.Primary"
            >
                @foreach (DisciplinaOut? item in Disciplinas)
                {
                    if (item.IsSelected && item.Id != _disciplina?.Id) continue;
                    <MudSelectItem Value="@item">@item.Nome</MudSelectItem>
                }
            </MudSelect>
        </MudItem>
        <MudItem xs="2">
            <MudTextField @bind-Value="_periodo" Label="Período" Required="true" RequiredError="Informe o período!" />
        </MudItem>
        <MudItem xs="2">
            <MudTextField @bind-Value="_creditos" Label="Créditos" Required="true" RequiredError="Informe os créditos!" />
        </MudItem>
        <MudItem xs="2">
            <MudTextField @bind-Value="_cargaHoraria" Label="Carga Horária" Required="true" RequiredError="Informe a carga horária!" />
        </MudItem>
    </MudStack>
</MudForm>

@using Syki.Dtos
@using System.Text.RegularExpressions
@using System.ComponentModel.DataAnnotations
@inject HttpClient httpClient
@inject ISnackbar Snackbar

@code {
    MudForm form;

    [CascadingParameter]
    public List<DisciplinaOut> Disciplinas { get; set; }

    DisciplinaOut? _disciplina;
    byte? _periodo;
    byte? _creditos;
    ushort? _cargaHoraria;

    void HandleValueChanged(DisciplinaOut newValue)
    {
        if (_disciplina != null)
        {
            Disciplinas.First(d => d.Id == _disciplina.Id).IsSelected = false;
        }

        Disciplinas.First(d => d.Id == newValue.Id).IsSelected = true;
        _disciplina = newValue;
        Disciplinas.ForEach(p => Console.WriteLine(p.IsSelected));
    }

    async Task Submit()
    {
        await form.Validate();
        if (!form.IsValid) return;

        Snackbar.Add("Grade cadastrada com sucesso!", Severity.Success);
    }
}
