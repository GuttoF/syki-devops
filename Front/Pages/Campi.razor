@page "/campi"

<PageTitle>Campi</PageTitle>

<MudContainer Class="mt-8 px-8" MaxWidth="MaxWidth.False">
    @if(_campus == null)
    {
        <MudProgressLinear Color="Color.Primary" Indeterminate="true" Class="my-7" />
    }
    else
    {
        <MudGrid>
            <MudItem xs="12">
                <MudGrid Justify="Justify.FlexStart">
                    @foreach (var c in _campus)
                    {
                        <MudItem xs="12" sm="6" md="4" lg="3" xl="2">
                            <MudPaper Height="100px" Class="d-flex flex-column align-center justify-center mud-width-full py-8">
                                <MudText Typo="Typo.h6" Align="Align.Center" Variant="Variant.Outlined">@c.Nome</MudText>
                            </MudPaper>
                        </MudItem>
                    }
                    <MudItem xs="12" sm="6" md="4" lg="3" xl="2">
                        <MudButton
                            StartIcon="@Icons.Material.Outlined.Add"
                            IconSize="Size.Large"
                            Variant="Variant.Outlined"
                            FullWidth="true"
                            Class="border-dashed border-2 mud-border-secundary"
                            Style="height: 100px;"
                            Color="Color.Primary"
                            @onclick="OpenDialog"
                        >
                            Novo Campus
                        </MudButton>
                    </MudItem>
                </MudGrid>
            </MudItem>
        </MudGrid>
    }
</MudContainer>

@using Syki.Dtos
@inject HttpClient Http
@inject IDialogService DialogService

@code {
    private List<CampusOut>? _campus;

    protected override async Task OnInitializedAsync()
    {
        _campus = await Http.GetFromJsonAsync<List<CampusOut>>("/campi") ?? new();
    }

    private async Task OpenDialog()
    {
        var options = new DialogOptions {
            MaxWidth = MaxWidth.Small,
            FullWidth = true
        };
        var dialog = await DialogService.ShowAsync<NewCampusDialog>("Novo Campus", options);

        var result = await dialog.Result;

        if (result.Canceled) return;
        
        await OnInitializedAsync();
    }
}
